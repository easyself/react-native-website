<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Custom WebView · React Native 中文网</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="##### 本文档贡献者：[sunnylqm](https://github.com/search?q=sunnylqm%40qq.com+in%3Aemail&amp;type=Users)(100.00%)"/><meta name="docsearch:version" content="0.59"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Custom WebView · React Native 中文网"/><meta property="og:type" content="website"/><meta property="og:url" content="undefined/"/><meta property="og:description" content="##### 本文档贡献者：[sunnylqm](https://github.com/search?q=sunnylqm%40qq.com+in%3Aemail&amp;type=Users)(100.00%)"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/easyself/react-native-website@1.0.0/img/favicon.ico"/><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/highlight.js@9.18.1/styles/solarized-dark.min.css"/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/focus-visible@5.0.2/dist/focus-visible.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@1.0.0/js/codeblocks.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@1.0.0/js/tabs.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@1.0.0/js/doccode0325.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@1.0.0/js/snack.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@1.0.0/js/scrollSpy.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/easyself/react-native-website@1.0.0/css/main.css"/><script src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@1.0.0/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@1.0.0/img/header_logo.svg" alt="React Native 中文网"/><h2 class="headerTitleWithLogo">React Native 中文网</h2></a><a href="/versions"><h3>0.59</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/0.59/getting-started" target="_self">文档</a></li><li class=""><a href="/docs/0.59/activityindicator" target="_self">API</a></li><li class=""><a href="//github.com/easyself/react-native-website/issues" target="_blank">讨论</a></li><li class=""><a href="/about" target="_self">关于</a></li><li class=""><a target="_self"></a></li><li class=""><a href="https://github.com/facebook/react-native" target="_self">GitHub</a></li><li class=""><a href="//zh-hans.reactjs.org/" target="_blank">React</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="//www.github.com/easyself/react-native-website/blob/production/cndocs/custom-webview-ios.md" target="_blank" rel="noreferrer noopener">帮助改进此文档</a><h1 id="__docusaurus" class="postHeaderTitle">Custom WebView</h1></header><article><div><span><h5><a class="anchor" aria-hidden="true" id="本文档贡献者：sunnylqmhttpsgithubcomsearchqsunnylqm40qqcomin3aemailtypeusers10000"></a><a href="#本文档贡献者：sunnylqmhttpsgithubcomsearchqsunnylqm40qqcomin3aemailtypeusers10000" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>本文档贡献者：<a href="https://github.com/search?q=sunnylqm%40qq.com+in%3Aemail&amp;type=Users">sunnylqm</a>(100.00%)</h5>
<p>While the built-in web view has a lot of features, it is not possible to handle every use-case in React Native. You can, however, extend the web view with native code without forking React Native or duplicating all the existing web view code.</p>
<p>Before you do this, you should be familiar with the concepts in <a href="native-components-ios">native UI components</a>. You should also familiarise yourself with the <a href="https://github.com/facebook/react-native/blob/master/React/Views/RCTWebViewManager.m">native code for web views</a>, as you will have to use this as a reference when implementing new features—although a deep understanding is not required.</p>
<h2><a class="anchor" aria-hidden="true" id="native-code"></a><a href="#native-code" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Native Code</h2>
<p>Like for regular native components, you need a view manager and an web view.</p>
<p>For the view, you'll need to make a subclass of <code>RCTWebView</code>.</p>
<pre><code class="hljs css language-objc"><span class="hljs-comment">// RCTCustomWebView.h</span>
<span class="hljs-meta">#import <span class="hljs-meta-string">&lt;React/RCTWebView.h&gt;</span></span>

<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">RCTCustomWebView</span> : <span class="hljs-title">RCTWebView</span></span>

<span class="hljs-keyword">@end</span>

<span class="hljs-comment">// RCTCustomWebView.m</span>
<span class="hljs-meta">#import <span class="hljs-meta-string">"RCTCustomWebView.h"</span></span>

<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">RCTCustomWebView</span> ()</span>

<span class="hljs-keyword">@end</span>

<span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">RCTCustomWebView</span> </span>{ }

<span class="hljs-keyword">@end</span>
</code></pre>
<p>For the view manager, you need to make a subclass <code>RCTWebViewManager</code>. You must still include:</p>
<ul>
<li><code>(UIView *)view</code> that returns your custom view</li>
<li>The <code>RCT_EXPORT_MODULE()</code> tag</li>
</ul>
<pre><code class="hljs css language-objc"><span class="hljs-comment">// RCTCustomWebViewManager.h</span>
<span class="hljs-meta">#import <span class="hljs-meta-string">&lt;React/RCTWebViewManager.h&gt;</span></span>

<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">RCTCustomWebViewManager</span> : <span class="hljs-title">RCTWebViewManager</span></span>

<span class="hljs-keyword">@end</span>

<span class="hljs-comment">// RCTCustomWebViewManager.m</span>
<span class="hljs-meta">#import <span class="hljs-meta-string">"RCTCustomWebViewManager.h"</span></span>
<span class="hljs-meta">#import <span class="hljs-meta-string">"RCTCustomWebView.h"</span></span>

<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">RCTCustomWebViewManager</span> () &lt;<span class="hljs-title">RCTWebViewDelegate</span>&gt;</span>

<span class="hljs-keyword">@end</span>

<span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">RCTCustomWebViewManager</span> </span>{ }

RCT_EXPORT_MODULE()

- (<span class="hljs-built_in">UIView</span> *)view
{
  RCTCustomWebView *webView = [RCTCustomWebView new];
  webView.delegate = <span class="hljs-keyword">self</span>;
  <span class="hljs-keyword">return</span> webView;
}

<span class="hljs-keyword">@end</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="adding-new-events-and-properties"></a><a href="#adding-new-events-and-properties" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding New Events and Properties</h3>
<p>Adding new properties and events is the same as regular UI components. For properties, you define an <code>@property</code> in the header. For events, you define a <code>RCTDirectEventBlock</code> in the view's <code>@interface</code>.</p>
<pre><code class="hljs css language-objc"><span class="hljs-comment">// RCTCustomWebView.h</span>
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>) <span class="hljs-built_in">NSString</span> *finalUrl;

<span class="hljs-comment">// RCTCustomWebView.m</span>
<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">RCTCustomWebView</span> ()</span>

<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>) RCTDirectEventBlock onNavigationCompleted;

<span class="hljs-keyword">@end</span>
</code></pre>
<p>Then expose it in the view manager's <code>@implementation</code>.</p>
<pre><code class="hljs css language-objc"><span class="hljs-comment">// RCTCustomWebViewManager.m</span>
RCT_EXPORT_VIEW_PROPERTY(onNavigationCompleted, RCTDirectEventBlock)
RCT_EXPORT_VIEW_PROPERTY(finalUrl, <span class="hljs-built_in">NSString</span>)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="extending-existing-events"></a><a href="#extending-existing-events" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Extending Existing Events</h3>
<p>You should refer to <a href="https://github.com/facebook/react-native/blob/master/React/Views/RCTWebView.m">RCTWebView.m</a> in the React Native codebase to see what handlers are available and how they are implemented. You can extend any methods here to provide extra functionality.</p>
<p>By default, most methods aren't exposed from RCTWebView. If you need to expose them, you need to create an <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html">Objective C category</a>, and then expose all the methods you need to use.</p>
<pre><code class="hljs css language-objc"><span class="hljs-comment">// RCTWebView+Custom.h</span>
<span class="hljs-meta">#import <span class="hljs-meta-string">&lt;React/RCTWebView.h&gt;</span></span>

<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">RCTWebView</span> (<span class="hljs-title">Custom</span>)</span>
- (<span class="hljs-built_in">BOOL</span>)webView:(__unused <span class="hljs-built_in">UIWebView</span> *)webView shouldStartLoadWithRequest:(<span class="hljs-built_in">NSURLRequest</span> *)request navigationType:(<span class="hljs-built_in">UIWebViewNavigationType</span>)navigationType;
- (<span class="hljs-built_in">NSMutableDictionary</span>&lt;<span class="hljs-built_in">NSString</span> *, <span class="hljs-keyword">id</span>&gt; *)baseEvent;
<span class="hljs-keyword">@end</span>
</code></pre>
<p>Once these are exposed, you can reference them in your custom web view class.</p>
<pre><code class="hljs css language-objc"><span class="hljs-comment">// RCTCustomWebView.m</span>

<span class="hljs-comment">// Remember to import the category file.</span>
<span class="hljs-meta">#import <span class="hljs-meta-string">"RCTWebView+Custom.h"</span></span>

- (<span class="hljs-built_in">BOOL</span>)webView:(__unused <span class="hljs-built_in">UIWebView</span> *)webView shouldStartLoadWithRequest:(<span class="hljs-built_in">NSURLRequest</span> *)request
 navigationType:(<span class="hljs-built_in">UIWebViewNavigationType</span>)navigationType
{
  <span class="hljs-built_in">BOOL</span> allowed = [<span class="hljs-keyword">super</span> webView:webView shouldStartLoadWithRequest:request navigationType:navigationType];

  <span class="hljs-keyword">if</span> (allowed) {
    <span class="hljs-built_in">NSString</span>* url = request.URL.absoluteString;
    <span class="hljs-keyword">if</span> (url &amp;&amp; [url isEqualToString:_finalUrl]) {
      <span class="hljs-keyword">if</span> (_onNavigationCompleted) {
        <span class="hljs-built_in">NSMutableDictionary</span>&lt;<span class="hljs-built_in">NSString</span> *, <span class="hljs-keyword">id</span>&gt; *event = [<span class="hljs-keyword">self</span> baseEvent];
        _onNavigationCompleted(event);
      }
    }
  }

  <span class="hljs-keyword">return</span> allowed;
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="javascript-interface"></a><a href="#javascript-interface" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JavaScript Interface</h2>
<p>To use your custom web view, you'll need to create a class for it. Your class must:</p>
<ul>
<li>Export all the prop types from <code>WebView.propTypes</code></li>
<li>Return a <code>WebView</code> component with the prop <code>nativeConfig.component</code> set to your native component (see below)</li>
</ul>
<p>To get your native component, you must use <code>requireNativeComponent</code>: the same as for regular custom components. However, you must pass in an extra third argument, <code>WebView.extraNativeComponentConfig</code>. This third argument contains prop types that are only required for native code.</p>
<pre><code class="hljs css language-jsx"><span class="hljs-keyword">import</span> React, {Component, PropTypes} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> {WebView, requireNativeComponent, NativeModules} <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;
<span class="hljs-keyword">const</span> {CustomWebViewManager} = NativeModules;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomWebView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  <span class="hljs-keyword">static</span> propTypes = WebView.propTypes;

  render() {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">WebView</span>
        {<span class="hljs-attr">...this.props</span>}
        <span class="hljs-attr">nativeConfig</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">component:</span> <span class="hljs-attr">RCTCustomWebView</span>,
          <span class="hljs-attr">viewManager:</span> <span class="hljs-attr">CustomWebViewManager</span>,
        }}
      /&gt;</span></span>
    );
  }
}

<span class="hljs-keyword">const</span> RCTCustomWebView = requireNativeComponent(
  <span class="hljs-string">'RCTCustomWebView'</span>,
  CustomWebView,
  WebView.extraNativeComponentConfig
);
</code></pre>
<p>If you want to add custom props to your native component, you can use <code>nativeConfig.props</code> on the web view. For iOS, you should also set the <code>nativeConfig.viewManager</code> prop with your custom WebView ViewManager as in the example above.</p>
<p>For events, the event handler must always be set to a function. This means it isn't safe to use the event handler directly from <code>this.props</code>, as the user might not have provided one. The standard approach is to create a event handler in your class, and then invoking the event handler given in <code>this.props</code> if it exists.</p>
<p>If you are unsure how something should be implemented from the JS side, look at <a href="https://github.com/facebook/react-native/blob/master/Libraries/Components/WebView/WebView.ios.js">WebView.ios.js</a> in the React Native source.</p>
<pre><code class="hljs css language-jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomWebView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  <span class="hljs-keyword">static</span> propTypes = {
    ...WebView.propTypes,
    <span class="hljs-attr">finalUrl</span>: PropTypes.string,
    <span class="hljs-attr">onNavigationCompleted</span>: PropTypes.func,
  };

  <span class="hljs-keyword">static</span> defaultProps = {
    <span class="hljs-attr">finalUrl</span>: <span class="hljs-string">'about:blank'</span>,
  };

  _onNavigationCompleted = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> {onNavigationCompleted} = <span class="hljs-keyword">this</span>.props;
    onNavigationCompleted &amp;&amp; onNavigationCompleted(event);
  };

  render() {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">WebView</span>
        {<span class="hljs-attr">...this.props</span>}
        <span class="hljs-attr">nativeConfig</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">component:</span> <span class="hljs-attr">RCTCustomWebView</span>,
          <span class="hljs-attr">props:</span> {
            <span class="hljs-attr">finalUrl:</span> <span class="hljs-attr">this.props.finalUrl</span>,
            <span class="hljs-attr">onNavigationCompleted:</span> <span class="hljs-attr">this._onNavigationCompleted</span>,
          },
          <span class="hljs-attr">viewManager:</span> <span class="hljs-attr">CustomWebViewManager</span>,
        }}
      /&gt;</span></span>
    );
  }
}
</code></pre>
<p>Just like for regular native components, you must provide all your prop types in the component to have them forwarded on to the native component. However, if you have some prop types that are only used internally in component, you can add them to the <code>nativeOnly</code> property of the third argument previously mentioned. For event handlers, you have to use the value <code>true</code> instead of a regular prop type.</p>
<p>For example, if you wanted to add an internal event handler called <code>onScrollToBottom</code>, you would use,</p>
<pre><code class="hljs css language-jsx"><span class="hljs-keyword">const</span> RCTCustomWebView = requireNativeComponent(
  <span class="hljs-string">'RCTCustomWebView'</span>,
  CustomWebView,
  {
    ...WebView.extraNativeComponentConfig,
    <span class="hljs-attr">nativeOnly</span>: {
      ...WebView.extraNativeComponentConfig.nativeOnly,
      <span class="hljs-attr">onScrollToBottom</span>: <span class="hljs-literal">true</span>,
    },
  }
);
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#native-code">Native Code</a><ul class="toc-headings"><li><a href="#adding-new-events-and-properties">Adding New Events and Properties</a></li><li><a href="#extending-existing-events">Extending Existing Events</a></li></ul></li><li><a href="#javascript-interface">JavaScript Interface</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright"><p style="color:inherit">React Native中文网 © 2021</p></section></footer></div></body></html>