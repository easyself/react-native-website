<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>打包APK · React Native 中文网</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="##### 本文档贡献者：[sunnylqm](https://github.com/search?q=sunnylqm%40qq.com+in%3Aemail&amp;type=Users)(100.00%)"/><meta name="docsearch:version" content="0.60"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="打包APK · React Native 中文网"/><meta property="og:type" content="website"/><meta property="og:url" content="undefined/"/><meta property="og:description" content="##### 本文档贡献者：[sunnylqm](https://github.com/search?q=sunnylqm%40qq.com+in%3Aemail&amp;type=Users)(100.00%)"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/easyself/react-native-website@gh-pages/img/favicon.ico"/><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/highlight.js@9.18.1/styles/solarized-dark.min.css"/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/focus-visible@5.0.2/dist/focus-visible.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@gh-pages/js/codeblocks.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@gh-pages/js/tabs.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@gh-pages/js/doccode0325.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@gh-pages/js/snack.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@gh-pages/js/scrollSpy.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/easyself/react-native-website@gh-pages/css/main.css"/><script src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@gh-pages/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="https://cdn.jsdelivr.net/gh/easyself/react-native-website@gh-pages/img/header_logo.svg" alt="React Native 中文网"/><h2 class="headerTitleWithLogo">React Native 中文网</h2></a><a href="/versions"><h3>0.60</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/0.60/getting-started" target="_self">文档</a></li><li class=""><a href="/docs/0.60/activityindicator" target="_self">API</a></li><li class=""><a href="//github.com/easyself/react-native-website/issues" target="_blank">讨论</a></li><li class=""><a href="/about" target="_self">关于</a></li><li class=""><a target="_self"></a></li><li class=""><a href="https://github.com/facebook/react-native" target="_self">GitHub</a></li><li class=""><a href="//zh-hans.reactjs.org/" target="_blank">React</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>使用指南(Android)</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">入门基础<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/0.60/getting-started">搭建开发环境</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/tutorial">示例教程：Hello World</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/props">Props（属性）</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/state">State（状态）</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/style">样式</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/height-and-width">高度与宽度</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/flexbox">使用Flexbox布局</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/handling-text-input">处理文本输入</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/handling-touches">处理触摸事件</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/using-a-scrollview">使用滚动视图</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/using-a-listview">使用长列表</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/network">网络</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/sample-application-movies">示例教程：电影列表</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/more-resources">其他参考资源</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">进阶指南<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/0.60/components-and-apis">组件和API</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/platform-specific-code">特定平台代码</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/navigation">使用导航器跳转页面</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/images">图片</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/animations">动画</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/accessibility">无障碍功能</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/improvingux">改进用户体验</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/timers">定时器</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/debugging">调试</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/performance">性能</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/gesture-responder-system">手势响应系统</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/javascript-environment">JavaScript环境</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/direct-manipulation">直接操作</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/colors">颜色</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/integration-with-existing-apps">集成到现有原生应用</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/building-for-apple-tv">为电视和机顶盒制作应用</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/running-on-device">在设备上运行</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/upgrading">更新</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/native-modules-setup">原生模块配置</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/out-of-tree-platforms">多平台支持</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/building-from-source">从源代码编译React Native</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/publishing-forks">发布自己定制的ReactNative包</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/testing">Testing your Changes</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">使用指南(iOS)<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/0.60/native-modules-ios">原生模块</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/native-components-ios">原生UI组件</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/linking-libraries-ios">链接原生库</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/running-on-simulator-ios">在iOS模拟器上运行</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/communication-ios">和原生端通信</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/app-extensions">iOS应用扩展</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">使用指南(Android)<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/0.60/native-modules-android">原生模块</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/native-components-android">原生UI组件</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/headless-js-android">Headless JS（后台任务）</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/0.60/signed-apk-android">打包APK</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/removing-default-permissions">移除不需要的权限</a></li><li class="navListItem"><a class="navItem" href="/docs/0.60/hermes">Using Hermes</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="//easyself.github.com/react-native-website/blob/production/cndocs/signed-apk-android.md" target="_blank" rel="noreferrer noopener">帮助改进此文档</a><h1 id="__docusaurus" class="postHeaderTitle">打包APK</h1></header><article><div><span><h5><a class="anchor" aria-hidden="true" id="本文档贡献者：sunnylqmhttpsgithubcomsearchqsunnylqm40qqcomin3aemailtypeusers10000"></a><a href="#本文档贡献者：sunnylqmhttpsgithubcomsearchqsunnylqm40qqcomin3aemailtypeusers10000" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>本文档贡献者：<a href="https://github.com/search?q=sunnylqm%40qq.com+in%3Aemail&amp;type=Users">sunnylqm</a>(100.00%)</h5>
<p>Android 要求所有应用都有一个数字签名才会被允许安装在用户手机上，所以在把应用发布到类似<a href="https://play.google.com/store">Google Play store</a>这样的应用市场之前，你需要先生成一个签名的 APK 包。Android 开发者官网上的<a href="https://developer.android.com/tools/publishing/app-signing.html">如何给你的应用签名</a>文档描述了签名的细节。本指南旨在提供一个简化的签名和打包 js 的操作步骤，不会涉及太多理论。</p>
<h3><a class="anchor" aria-hidden="true" id="生成一个签名密钥"></a><a href="#生成一个签名密钥" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生成一个签名密钥</h3>
<p>你可以用<code>keytool</code>命令生成一个私有密钥。在 Windows 上<code>keytool</code>命令放在 JDK 的 bin 目录中（比如<code>C:\Program Files\Java\jdkx.x.x_x\bin</code>），你可能需要在命令行中先进入那个目录才能执行此命令。</p>
<pre><code class="hljs">$ keytool -genkeypair -v -keystore my-release-key.keystore -alias my-key-alias -keyalg RSA -keysize 2048 -validity 10000
</code></pre>
<p>这条命令会要求你输入密钥库（keystore）和对应密钥的密码，然后设置一些发行相关的信息。最后它会生成一个叫做<code>my-release-key.keystore</code>的密钥库文件。</p>
<p>在运行上面这条语句之后，密钥库里应该已经生成了一个单独的密钥，有效期为 10000 天。--alias 参数后面的别名是你将来为应用签名时所需要用到的，所以记得记录这个别名。</p>
<p><strong>注意：请记得妥善地保管好你的密钥库文件，一般不要上传到版本库或者其它的地方。</strong></p>
<h3><a class="anchor" aria-hidden="true" id="设置-gradle-变量"></a><a href="#设置-gradle-变量" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设置 gradle 变量</h3>
<ol>
<li>把<code>my-release-key.keystore</code>文件放到你工程中的<code>android/app</code>文件夹下。</li>
<li>编辑<code>~/.gradle/gradle.properties</code>（全局配置，对所有项目有效）或是<code>项目目录/android/gradle.properties</code>（项目配置，只对所在项目有效）。如果没有<code>gradle.properties</code>文件你就自己创建一个，添加如下的代码（注意把其中的<code>****</code>替换为相应密码）</li>
</ol>
<p><strong>注意：~符号表示用户目录，比如 windows 上可能是<code>C:\Users\用户名</code>，而 mac 上可能是<code>/Users/用户名</code>。</strong></p>
<pre><code class="hljs"><span class="hljs-attr">MYAPP_RELEASE_STORE_FILE</span>=my-release-key.keystore
<span class="hljs-attr">MYAPP_RELEASE_KEY_ALIAS</span>=my-key-alias
<span class="hljs-attr">MYAPP_RELEASE_STORE_PASSWORD</span>=*****
<span class="hljs-attr">MYAPP_RELEASE_KEY_PASSWORD</span>=*****
</code></pre>
<p>上面的这些会作为 gradle 的变量，在后面的步骤中可以用来给应用签名。</p>
<blockquote>
<p><strong>关于密钥库的注意事项:</strong></p>
</blockquote>
<blockquote>
<p>一旦你在 Play Store 发布了你的应用，如果想修改签名，就必须用一个不同的包名来重新发布你的应用（这样也会丢失所有的下载数和评分）。所以请务必备份好你的密钥库和密码。</p>
</blockquote>
<p>提示：如果你不想以明文方式保存密码，同时你使用的是 macOS 系统，那么你也可以把密码<a href="https://pilloxa.gitlab.io/posts/safer-passwords-in-gradle/">保存到钥匙串（Keychain）中</a>。这样一来你就可以省略掉上面配置中的后两行（即 MYAPP_RELEASE_STORE_PASSWORD 和 MYAPP_RELEASE_KEY_PASSWORD）。</p>
<h3><a class="anchor" aria-hidden="true" id="把签名配置加入到项目的-gradle-配置中"></a><a href="#把签名配置加入到项目的-gradle-配置中" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>把签名配置加入到项目的 gradle 配置中</h3>
<p>编辑你项目目录下的<code>android/app/build.gradle</code>，添加如下的签名配置：</p>
<pre><code class="hljs css language-gradle">...
android {
    ...
    defaultConfig { ... }
    signingConfigs {
        release {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">project</span>.hasProperty(<span class="hljs-string">'MYAPP_RELEASE_STORE_FILE'</span>)) {
                storeFile <span class="hljs-keyword">file</span>(MYAPP_RELEASE_STORE_FILE)
                storePassword MYAPP_RELEASE_STORE_PASSWORD
                keyAlias MYAPP_RELEASE_KEY_ALIAS
                keyPassword MYAPP_RELEASE_KEY_PASSWORD
            }
        }
    }
    buildTypes {
        release {
            ...
            signingConfig signingConfigs.release
        }
    }
}
...
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="生成发行-apk-包"></a><a href="#生成发行-apk-包" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生成发行 APK 包</h3>
<p>只需在终端中运行以下命令：</p>
<pre><code class="hljs css language-sh">$ <span class="hljs-built_in">cd</span> android
$ ./gradlew assembleRelease
</code></pre>
<blockquote>
<p>译注：<code>cd android</code>表示进入 android 目录（如果你已经在 android 目录中了那就不用输入了）。<code>./gradlew assembleRelease</code>在 macOS、Linux 或是 windows 的 PowerShell 环境中表示执行当前目录下的名为 gradlew 的脚本文件，且其运行参数为 assembleRelease，注意这个<code>./</code>不可省略；而在 windows 的传统 CMD 命令行下则需要去掉<code>./</code>。</p>
</blockquote>
<p>Gradle 的<code>assembleRelease</code>参数会把所有用到的 JavaScript 代码都打包到一起，然后内置到 APK 包中。如果你想调整下这个行为（比如 js 代码以及静态资源打包的默认文件名或是目录结构等），可以看看<code>android/app/build.gradle</code>文件，然后琢磨下应该怎么修改以满足你的需求。</p>
<blockquote>
<p>注意：请确保 gradle.properties 中<code>没有</code>包含<code>_org.gradle.configureondemand=true_</code>，否则会跳过 js 打包的步骤，导致最终生成的 apk 是一个无法运行的空壳。</p>
</blockquote>
<p>生成的 APK 文件位于<code>android/app/build/outputs/apk/release/app-release.apk</code>，它已经可以用来发布了。</p>
<h3><a class="anchor" aria-hidden="true" id="测试应用的发行版本"></a><a href="#测试应用的发行版本" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>测试应用的发行版本</h3>
<p>在把发行版本提交到 Play Store 之前，你应该做一次最终测试。输入以下命令可以在设备上安装发行版本：</p>
<pre><code class="hljs css language-sh">$ react-native run-android --variant=release
</code></pre>
<p>注意<code>--variant=release</code>参数只能在你完成了上面的签名配置之后才可以使用。你现在可以关掉运行中的 packager 了，因为你所有的代码和框架依赖已经都被打包到 apk 包中，可以离线运行了。</p>
<blockquote>
<p>注意：在 debug 和 release 版本间来回切换安装时可能会报错签名不匹配，此时需要先卸载前一个版本再尝试安装。</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="针对不同的-cpu-架构生成-apk-以减小-apk-文件的大小"></a><a href="#针对不同的-cpu-架构生成-apk-以减小-apk-文件的大小" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>针对不同的 CPU 架构生成 APK 以减小 APK 文件的大小</h3>
<p>默认情况下，生成的 APK 会同时包含针对于 x86 和 ARMv7a 两种 CPU 架构的原生代码。这样可以让我们更方便的向其他人分享这个 APK，因为它几乎可以运行在所有的 Android 设备上。但是，这会导致所有设备上都有一些根本不会运行的代码，白白占据了空间。目前安卓设备绝大多数是 ARM 架构，因此对于大部分应用来说可以考虑去掉 x86 架构的支持。</p>
<p>你可以在<code>android/app/build.gradle</code>中修改如下代码（false 改为 true）来生成针对不同 CPU 架构的 APK。</p>
<pre><code class="hljs css language-diff"><span class="hljs-deletion">- ndk {</span>
<span class="hljs-deletion">-   abiFilters "armeabi-v7a", "x86"</span>
<span class="hljs-deletion">- }</span>
<span class="hljs-deletion">- def enableSeparateBuildPerCPUArchitecture = false</span>
<span class="hljs-addition">+ def enableSeparateBuildPerCPUArchitecture = true</span>
</code></pre>
<p>你可以把这上面打包生成的两个 APK 都上传到支持对用户设备 CPU 架构定位的应用程序商店，例如 Google Play 和 Amazon AppStore，用户将自动获得相应的 APK。如果您想上传到其他市场，例如 APKFiles（不支持一个应用有多个 APK 文件），可以修改下面的代码，来额外生成一个适用不同 CPU 架构的通用 APK。</p>
<pre><code class="hljs css language-diff"><span class="hljs-deletion">- universalApk false</span>
<span class="hljs-addition">+ universalApk true  // 额外生成一个适用不同CPU架构的通用APK</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="enabling-proguard-to-reduce-the-size-of-the-apk-optional"></a><a href="#enabling-proguard-to-reduce-the-size-of-the-apk-optional" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enabling Proguard to reduce the size of the APK (optional)</h3>
<p>Proguard 是一个 Java 字节码混淆压缩工具，它可以移除掉 React Native Java（和它的依赖库中）中没有被使用到的部分，最终有效的减少 APK 的大小。</p>
<p><strong>重要</strong>：启用 Proguard 之后，你必须再次全面地测试你的应用。Proguard 有时候需要为你引入的每个原生库做一些额外的配置。参见<code>app/proguard-rules.pro</code>文件。</p>
<p>要启用 Proguard，修改<code>android/app/build.gradle</code>文件：</p>
<pre><code class="hljs css language-gradle"><span class="hljs-comment">/**
 * Run Proguard to shrink the Java bytecode in release builds.
 */</span>
<span class="hljs-keyword">def</span> enableProguardInReleaseBuilds = <span class="hljs-keyword">true</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/0.60/headless-js-android"><span class="arrow-prev">← </span><span>Headless JS（后台任务）</span></a><a class="docs-next button" href="/docs/0.60/removing-default-permissions"><span>移除不需要的权限</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="copyright"><p style="color:inherit">React Native中文网 © 2020 武汉青罗网络科技有限公司</p><p style="color:inherit"><a href="http://beian.miit.gov.cn/">鄂ICP备20002031号</a><img src="https://img.alicdn.com/tfs/TB1..50QpXXXXX7XpXXXXXXXXXX-40-40.png" alt="浙公网安备 33010602005511号"/><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010602005511">浙公网安备 33010602005511号</a></p></section><script>
        (function(){
          var c = document.createElement("div");
          c.setAttribute("id", "lv-container");
          c.setAttribute("data-id", "city");
          c.setAttribute("data-uid", "MTAyMC8zODM4NS8xNDkxMw==");
          var container = document.querySelector(".mainContainer")
          container && container.appendChild(c);
        })()
        </script><script src="https://cdn-city.livere.com/js/embed.dist.js"></script></footer></div></body></html>